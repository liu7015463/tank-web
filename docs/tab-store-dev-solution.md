# Tab Store å¼€å‘ç¯å¢ƒè§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒZustand çš„ `persist` ä¸­é—´ä»¶ä¼šå°† tab æ•°æ®ä¿å­˜åˆ° `localStorage` ä¸­ï¼Œå¯¼è‡´ï¼š
1. å¼€å‘æ—¶æ—§çš„ tab æ•°æ®ä¼šè¢«ä¿ç•™
2. æ¯æ¬¡é‡å¯å¼€å‘æœåŠ¡å™¨æ—¶ï¼Œä¼šçœ‹åˆ°ä¹‹å‰çš„ tab çŠ¶æ€
3. å½±å“å¼€å‘ä½“éªŒå’Œè°ƒè¯•

## è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

- **å¼€å‘ç¯å¢ƒ**ï¼šæ¯æ¬¡å¯åŠ¨ `pnpm dev` æ—¶è‡ªåŠ¨æ¸…é™¤æ—§çš„ tab æ•°æ®ï¼Œä½¿ç”¨æ–°çš„å­˜å‚¨ key
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨å›ºå®šçš„å­˜å‚¨ key å’Œç‰ˆæœ¬å·æ§åˆ¶ï¼Œä¿æŒç”¨æˆ·æ•°æ®æŒä¹…åŒ–

### å®ç°ç»†èŠ‚

1. **ç¯å¢ƒæ£€æµ‹**ï¼šé€šè¿‡ `process.env.NODE_ENV` åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ

2. **å¼€å‘ç¯å¢ƒç­–ç•¥**ï¼š
   - **æœåŠ¡ç«¯æ¸²æŸ“**ï¼šä½¿ç”¨ä¸´æ—¶åç§° `tab-store-dev-ssr`
   - **å®¢æˆ·ç«¯**ï¼š
     - æ£€æŸ¥ `sessionStorage` ä¸­çš„ä¼šè¯ID
     - å¦‚æœæ˜¯æ–°ä¼šè¯ï¼Œæ¸…ç†æ‰€æœ‰æ—§çš„ `tab-store` æ•°æ®
     - ç”Ÿæˆå”¯ä¸€çš„å­˜å‚¨ keyï¼š`tab-store-dev-${sessionId}`
     - ä½¿ç”¨ `sessionStorage` ç¡®ä¿åŒä¸€æµè§ˆå™¨ä¼šè¯çš„ä¸€è‡´æ€§

3. **ç”Ÿäº§ç¯å¢ƒç­–ç•¥**ï¼š
   - ä½¿ç”¨å›ºå®šçš„å­˜å‚¨ keyï¼š`tab-store`
   - é€šè¿‡ `version` å­—æ®µæ§åˆ¶æ•°æ®è¿ç§»

### ä»£ç ç»“æ„

```typescript
// ç®€åŒ–çš„å¼€å‘ç¯å¢ƒè§£å†³æ–¹æ¡ˆ
const getStorageName = () => {
    if (process.env.NODE_ENV === 'development') {
        // æœåŠ¡ç«¯ï¼šè¿”å›ä¸´æ—¶åç§°
        if (typeof window === 'undefined') {
            return 'tab-store-dev-ssr';
        }

        // å®¢æˆ·ç«¯ï¼šä¼šè¯ç®¡ç†å’Œæ¸…ç†é€»è¾‘
        let sessionId = window.sessionStorage.getItem('tab-store-dev-session');
        if (!sessionId) {
            // æ–°ä¼šè¯ï¼šæ¸…ç†æ—§æ•°æ®ï¼Œç”Ÿæˆæ–°ID
            sessionId = Date.now().toString();
            // ... æ¸…ç†é€»è¾‘
        }
        return `tab-store-dev-${sessionId}`;
    }
    return 'tab-store'; // ç”Ÿäº§ç¯å¢ƒ
};

// Zustand store é…ç½®
export const useTabStore = create<TabStore>()(
    persist(
        immer((set, get) => ({ /* ... */ })),
        {
            name: getStorageName(), // åŠ¨æ€å­˜å‚¨åç§°
            version: 1, // ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬æ§åˆ¶
            partialize: (state) => ({ /* ... */ }),
        },
    ),
);
```

## ä½¿ç”¨æ•ˆæœ

### å¼€å‘ç¯å¢ƒ
- æ¯æ¬¡è¿è¡Œ `pnpm dev` éƒ½ä¼šçœ‹åˆ°å…¨æ–°çš„ tab çŠ¶æ€
- æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ¸…ç†æ—¥å¿—ï¼š`ğŸ§¹ [DEV] æ¸…ç†æ—§çš„ tab-store æ•°æ®`
- ä½¿ç”¨åŠ¨æ€å­˜å‚¨åç§°ï¼š`ğŸ”§ [DEV] ä½¿ç”¨å¼€å‘ç¯å¢ƒå­˜å‚¨åç§°`

### ç”Ÿäº§ç¯å¢ƒ
- ç”¨æˆ·çš„ tab çŠ¶æ€ä¼šè¢«æ­£å¸¸ä¿å­˜å’Œæ¢å¤
- é€šè¿‡ç‰ˆæœ¬å·æ§åˆ¶æ•°æ®è¿ç§»
- æ§åˆ¶å°æ˜¾ç¤ºï¼š`ğŸš€ [PROD] ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒå­˜å‚¨åç§°`

## æ‰‹åŠ¨æ¸…ç†æ–¹æ³•

å¦‚æœéœ€è¦æ‰‹åŠ¨æ¸…ç†æŒä¹…åŒ–æ•°æ®ï¼š

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰§è¡Œ
useTabStore.getState().clearPersistedData();
```

## æ³¨æ„äº‹é¡¹

1. å¼€å‘ç¯å¢ƒçš„æ¸…ç†åªåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œï¼ˆ`typeof window !== 'undefined'`ï¼‰
2. ä½¿ç”¨ `sessionStorage` ç¡®ä¿åŒä¸€æµè§ˆå™¨ä¼šè¯ä¸­çš„ä¸€è‡´æ€§
3. ç”Ÿäº§ç¯å¢ƒçš„ç‰ˆæœ¬å·éœ€è¦æ‰‹åŠ¨æ›´æ–°æ¥è§¦å‘æ•°æ®è¿ç§»
